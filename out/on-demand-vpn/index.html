<!DOCTYPE html><html><head><meta charSet="utf-8" class="next-head"/><title class="next-head">On Demand VPN using Google Cloud</title><link rel="preload" href="/_next/static/xhkINS7ujP0jMhX0t5QUt/pages/on-demand-vpn.js" as="script"/><link rel="preload" href="/_next/static/xhkINS7ujP0jMhX0t5QUt/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/xhkINS7ujP0jMhX0t5QUt/pages/_error.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-42652fa8b82c329c0559.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.bd276a29b27a8aba9fcf.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-7746b328e1f86339a555.js" as="script"/></head><body><div id="__next"><div><h1>On Demand VPN using Google Cloud</h1><h2>2016-12-29</h2><div><div><p>Given the amount of geo-restricted content on the internet these days, it can be nice to be able to reach for a VPN whenever you might need one.
Paying for a subscription to a VPN service is one way to do this, but if you, like me,
find your VPN needs to be very sporatic, then a subscription model probably doesn&#x27;t feel like the right way to go.</p><p>Today I would like to go over my solution to this, which is to use a SOCKS proxy to a cloud VM instead.
Instead of paying a monthly subscription, this means that you only pay as much as you use it.
For light to medium video streaming, this will most likely be below $1/month.</p><p>To get started, make sure that you have a Google Cloud account with valid billing info and a project set up.
If not, you can make one <a href="https://cloud.google.com/">here</a>.</p><p>After that install <a href="https://cloud.google.com/sdk/docs/quickstart-mac-os-x">Google Cloud SDK for OS X</a> and follow their guide to get it initialized.
Make sure you select the compute engine zone which corresponds to the country you&#x27;d like to have your VM in. You can find a list of the compute engine zones and their locations <a href="https://cloud.google.com/compute/docs/regions-zones/regions-zones#available">here</a>.</p><p>What we now want to do can be summarized in the following steps:
1. Create a micro VM
2. Set up an SSH tunnel to it
3. Tell OS X to use this tunnel as a SOCKS proxy
4. Wait for the user to finish using the tunnel
5. Tear everything down</p><p>Using the SDK and some native OS X commands, we can turn all of this into a handle little script, which you can find below:</p><pre><code class="language-bash" metaString="">#!/usr/bin/env bash

trap &#x27; &#x27; INT

echo &quot;Initializing...&quot;

# Start the VPN instance
gcloud compute instances create   tmp-vpn   --machine-type f1-micro

# Set up the SSH tunnel and activate proxy
# Sleep a bit first to make sure that the SSH connection is up before the proxy is enabled
(sleep 5; networksetup -setsocksfirewallproxy Wi-Fi localhost 4242) &amp; gcloud compute ssh tmp-vpn   --strict-host-key-checking=no   --command=&quot;echo &quot;VPN activated. Press Ctrl+C to exit.&quot; &amp;&amp; tail -f /dev/null&quot;   -- -D 4242

echo &quot;Cleaning up...&quot;

# Deactivate SOCKS proxy
networksetup -setsocksfirewallproxystate Wi-Fi off

# Delete the VPN instance
gcloud compute instances delete   tmp-vpn

echo &quot;Cleanup complete.&quot;
</code></pre><p>As you can see, there isn&#x27;t really anything to it,
so applying a similar approach to another cloud provider should be pretty straight forward.
While it does take a little bit of time to set up the connection and later tear down the VM,
we now have ourselves a very cost-effective on demand VPN.</p><p>Enjoy!</p></div></div></div></div><script>__NEXT_DATA__ = {"props":{"pageProps":{}},"page":"/on-demand-vpn","pathname":"/on-demand-vpn","query":{},"buildId":"xhkINS7ujP0jMhX0t5QUt","nextExport":true};__NEXT_LOADED_PAGES__=[];__NEXT_REGISTER_PAGE=function(r,f){__NEXT_LOADED_PAGES__.push([r, f])}</script><script async="" id="__NEXT_PAGE__/on-demand-vpn" src="/_next/static/xhkINS7ujP0jMhX0t5QUt/pages/on-demand-vpn.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/xhkINS7ujP0jMhX0t5QUt/pages/_app.js"></script><script async="" id="__NEXT_PAGE__/_error" src="/_next/static/xhkINS7ujP0jMhX0t5QUt/pages/_error.js"></script><script src="/_next/static/runtime/webpack-42652fa8b82c329c0559.js" async=""></script><script src="/_next/static/chunks/commons.bd276a29b27a8aba9fcf.js" async=""></script><script src="/_next/static/runtime/main-7746b328e1f86339a555.js" async=""></script></body></html>